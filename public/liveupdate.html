<html>
	<head>
		<title>###dvsmagic-field-12-caption###</title>
		<style>
			input[data-bind] {
				width: 100%;
			}
			.dashed {
				border: 1px dashed #333;
			}
			.awesome {
				padding: 20px;
			}
		</style>
	</head>
	<body>
		<div id="homepage">
			<div class="container pb sp100">

				<img data-devise="homepage_image, image" src="###dvsmagic-field-12-image_url###"
				 id="homepage-logo" width="###dvsmagic-field-12-width###" height="###dvsmagic-field-12-height###" alt="###dvsmagic-field-12-caption###">

				<div class="row">
					<div style="background-color: ###dvsmagic-field-17-color###; color: blue; font-size: ###dvsmagic-field-18-maxlength###px;" data-devise="homepage_main_text, wysiwyg" class="col-md-6 col-md-offset-3 ###dvsmagic-field-18-text###">
						###dvsmagic-field-15-text###

						some more stuff here...

						###dvsmagic-field-16-text###

						and finally the end of the text...
					</div>
				</div>

				<div class="row">
					<p>
						<input placeholder="edit field-12-image_url" data-bind="field-12-image_url" type="text">
					</p>
					<p>
						<input placeholder="edit field-12-height" data-bind="field-12-height" type="number">
					</p>
					<p>
						<input placeholder="edit field-12-width" data-bind="field-12-width" type="number">
					</p>
					<p>
						<input placeholder="edit field-12-caption" data-bind="field-12-caption" type="text">
					</p>
					<p>
						<input placeholder="edit field-17-color" data-bind="field-17-color" type="color">
					</p>
					<p>
						<input placeholder="edit field-18-maxlength" data-bind="field-18-maxlength" type="number">
					</p>
					<p>
						<input placeholder="edit field-18-text (class attribute)" data-bind="field-18-text" type="text">
					</p>
					<p>
						<textarea placeholder="edit field-15-text here" style="width: 100%; height: 100px;" data-bind="field-15-text"></textarea>
					</p>
					<p>
						<textarea placeholder="edit field-16-text here" style="width: 100%; height: 100px;" data-bind="field-16-text"></textarea>
					</p>
				</div>
			</div>
		</div>
	</body>

	<script src="/js/devise.js"></script>
	<script>

	var bindings;
	var database = {
		field: {
			'12' : { id: 12, values: { image_url: '/img/email-legal-logo.png', width: 90, height: 40, caption: 'Image caption AND page title' } },
			'15' : { id: 15, values: { text: 'YOU WANT ME FLUFF PILLOWS?<br><br><br>'} },
			'16' : { id: 16, values: { text: 'WELL LA-DEE-FREAKIN-DA!'} },
			'17' : { id: 17, values: { color: 'grey' } },
			'18' : { id: 18, values: { text: 'dashed awesome', maxlength: 20 } },
		},
		global: [],
		model: [],
	};

	devise.requirejs.s.contexts._.config.baseUrl = '/js/';

	devise.require(['BindingsFinder', 'jquery'], function(BindingsFinder, $)
	{
		var lookup = function(match, database)
		{
			var split = match.substring(3, match.length-3).split('-');
			var modelType = split[1];
			var modelId = split[2];
			var models = database[modelType];
			var model = models[modelId]

			return model.values;
		}

		var finder = new BindingsFinder(database, lookup);
		bindings = finder.find(document.children[0]);
		bindings.apply();







		$('[data-bind]').each(function(index, el)
		{
			var el = $(el);
			var target = el.data('bind');
			var parts = target.split('-');
			var type = parts[0];
			var id = parts[1];
			var attr = parts[2];

			el.val(database[type][id].values[attr]);
		});

		$('[data-bind]').on('input', function(e)
		{
			var el = $(e.currentTarget);
			var target = el.data('bind');
			var parts = target.split('-');
			var type = parts[0];
			var id = parts[1];
			var attr = parts[2];
			var value = el.val();
			var current = database[type][id].values[attr];

			if (value != current)
			{
				database[type][id].values[attr] = el.val();
				bindings.apply();
			}
		});
	})

	</script>
</html>
